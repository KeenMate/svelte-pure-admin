# Snippet Sync System

This document explains how the snippet synchronization system works between `@pure-admin/core` and `@pure-admin/svelte`.

## Overview

The snippet sync system uses hash-based change detection to identify when HTML snippets in `pure-admin-core/snippets/` have been modified. This helps ensure that Svelte components stay in sync with the latest snippet patterns.

## Files

- **Source of Truth:** `../pure-admin/pure-admin-core/snippets/manifest.json`
  - Generated by pure-admin-core build process
  - Contains SHA-256 hashes of all snippet files
  - Includes SCSS file hashes as well

- **Local Manifest:** `snippets-manifest.json` (in this repo)
  - Committed to version control
  - Tracks the last synced state
  - Updated manually with `--update` flag

- **Sync Script:** `scripts/sync-snippets.js`
  - Compares source and local manifests
  - Reports changes (added, modified, deleted)
  - Maps snippets to affected Svelte components

## Usage

### Check for Changes

```bash
npm run sync:snippets
# or
make sync-snippets
```

This will show:
- üì¶ **NEW SNIPPETS** - Snippets not in local manifest
- üîÑ **MODIFIED SNIPPETS** - Snippets with changed hashes
- ‚ùå **DELETED SNIPPETS** - Snippets removed from source
- ‚úÖ **UNCHANGED** - Snippets that match

### Update Local Manifest

After reviewing changes and updating components:

```bash
npm run sync:snippets:update
# or
make sync-snippets-update
```

This updates `snippets-manifest.json` to match the source manifest.

## Workflow

1. **Detect Changes:**
   ```bash
   npm run sync:snippets
   ```

2. **Review Output:**
   ```
   üîÑ MODIFIED SNIPPETS:
     ~ layout.html
       Old: 8. 10. 2025 14:25:00
       New: 11. 10. 2025 19:55:20
       Affected components:
         - src/lib/layout/Layout.svelte
         - src/lib/layout/Header.svelte
         - src/lib/layout/Sidebar.svelte
         - src/lib/layout/SidebarItem.svelte
         - src/lib/layout/Content.svelte
         - src/lib/layout/Footer.svelte
   ```

3. **Update Components:**
   - Read the changed snippet: `../pure-admin/pure-admin-core/snippets/layout.html`
   - Update affected Svelte components to match new structure
   - Test components in demo pages

4. **Sync Manifest:**
   ```bash
   npm run sync:snippets:update
   ```

5. **Commit Changes:**
   ```bash
   git add src/lib/layout/*.svelte snippets-manifest.json
   git commit -m "Update layout components to match latest snippets"
   ```

## Component Mapping

The script includes a mapping of snippets to components:

```javascript
{
  'layout.html': [
    'src/lib/layout/Layout.svelte',
    'src/lib/layout/Header.svelte',
    'src/lib/layout/Sidebar.svelte',
    'src/lib/layout/SidebarItem.svelte',
    'src/lib/layout/Content.svelte',
    'src/lib/layout/Footer.svelte'
  ],
  'forms.html': [
    'src/lib/forms/Input.svelte',
    'src/lib/forms/Textarea.svelte',
    // ... more components
  ]
  // ... more mappings
}
```

## Benefits

1. **Version Control:** Manifest is committed, so git tracks snippet sync state
2. **Change Detection:** Instantly see which snippets changed and when
3. **Component Tracking:** Know exactly which Svelte components need updating
4. **Hash-Based:** Reliable change detection using SHA-256 hashes
5. **Team Coordination:** Everyone can see when snippets are out of sync

## Integration with CI/CD

You can add a CI check to ensure snippets are synced:

```yaml
# .github/workflows/snippet-check.yml
- name: Check snippet sync
  run: npm run sync:snippets
  # Fails if there are unsynced changes
```

## Troubleshooting

**Q: Sync shows changes but I haven't updated components yet**
- A: This is expected. Review the changes, update components, then run `--update`

**Q: Should I commit snippets-manifest.json?**
- A: Yes! It must be in version control to track sync state across the team

**Q: What if pure-admin-core manifest doesn't exist?**
- A: The script will error. Make sure pure-admin-core is built and manifest is generated

**Q: Can I sync SCSS changes too?**
- A: The manifest includes SCSS hashes, but this script focuses on HTML snippets only
